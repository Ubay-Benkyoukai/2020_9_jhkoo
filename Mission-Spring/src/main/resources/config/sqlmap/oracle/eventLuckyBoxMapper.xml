<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="event.dao.LuckyBoxDAO">

	<resultMap type="luckyBoxVO" id="luckyBoxMap">
		<result column="goods_key" property="goodsKey" />
		<result column="event_no" property="eventNo" />
	</resultMap>

	<insert id="insertLuckyBox">
		INSERT INTO lucky_box(goods_key, event_no, goods, amount)
		VALUES(#{goodsKey}, #{eventNo}, #{goods}, #{amount})
	</insert>

	<select id="getLuckyBox" resultMap="luckyBoxMap" parameterType="luckyBoxVO">
		SELECT goods_key, event_no, goods, amount
		FROM lucky_box
		WHERE event_no = #{eventNo}
	</select>

	<select id="getMaxGoodsKey" resultType="int" parameterType="int">
		SELECT MAX(goods_key)
		FROM lucky_box
		WHERE event_no = #{eventNo} AND amount > 0
	</select>
	
	<update id="updateluckyBox" parameterType="luckyBoxVO">
		UPDATE lucky_box
		SET amount = amount - 1
		WHERE event_no = #{eventNo} AND goods_key = #{goodsKey}
	</update>
</mapper>