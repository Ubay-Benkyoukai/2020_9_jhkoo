<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board.dao.BoardDAO">

<select id="selectAll" resultType="boardVO">
          SELECT (@ROWNUM:=@ROWNUM+1) AS rno, no, title, writer, date_format(reg_date, '%Y-%m-%d') as regDate
              FROM(SELECT @ROWNUM:=0) AS rno, a_board
              WHERE (@ROWNUM:=0)=0
              ORDER BY rno DESC
      </select>

	<!-- 게시물 목록 페이징 (추가코드)-->
	<select id="count" resultType="int">
	 SELECT COUNT(no) 
	 FROM a_board
	</select>
	
  	<!-- '_'는 자동으로 객체 반환해주지 못함. 그래서 이 작업 필요. -->
  	<resultMap type="boardVO" id="boardMap">
  		<result column="view_cnt" property="viewCnt" />
  		<result column="reg_date" property="regDate" />
  	</resultMap>
  	
  	<!-- 게시글 상세보기 -->
  	<select id="selectByNo" resultMap="boardMap" parameterType="int">
  		SELECT (@ROWNUM:=@ROWNUM+1) AS rno, no, title, writer, content, view_cnt, date_format(reg_date, '%Y-%m-%d') as regDate
  		FROM(SELECT @ROWNUM:=0) AS rno, a_board
  		WHERE no = #{no}
  	</select>
  	

  	<!-- 게시글 추가 -->
  	<insert id="insert" parameterType="boardVO">
  		INSERT INTO a_board(title, writer, content)
  		VALUES(#{title}, #{writer}, #{content})
  	</insert>
  	
  	<!-- 댓글 카운트 증가 -->
  	<update id="increamentReplyCnt" parameterType="int">
  		UPDATE a_board
  			SET reply_cnt = reply_cnt + 1
  		 WHERE no = #{no}
  	</update>
  	
  	<!-- 댓글 카운트 감소 -->
  	<update id="reduceReplyCnt" parameterType="int">
  		UPDATE a_board
  			SET reply_cnt = reply_cnt - 1
  		 WHERE no = #{no}
  	</update>
  	
  	<!-- 게시글 수정 -->
  	<update id = "update" parameterType="boardVO"> 
  		UPDATE a_board SET
  			title = #{title},
  			content = #{content}
  		WHERE no = #{no}
  	</update>
  	
  	<!-- 게시글 삭제 -->
  	<delete id = "delete">
  		DELETE FROM a_board 
  		WHERE no = #{no}
  	</delete>
</mapper>



